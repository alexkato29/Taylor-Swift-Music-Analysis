---
title: "LB"
output: html_document
date: "2024-03-22"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
#("taylor")
library(taylor)
#data(package = "taylor")

#install.packages("compindexR")
library(compindexR)
library(dplyr)
library(stringr)
library(ggplot2)
library(cowplot)
```

## Different Data Sets

eras_tour_surprise  -->   The Eras Tour Surprise Songs
taylor_album_songs  -->   Data for Taylor Swift songs
taylor_albums  -->     Data for Taylor Swift's studio albums and EPs
taylor_all_songs  -->   Data for Taylor Swift songs

## Lyric cleaning logic
```{r}
df <- taylor_all_songs 
n <- nrow(df)

## Creating lyric dataframe 
lyric_matrix <- matrix(ncol = 2, nrow = n)

for (i in 1:n){
  
  ## Getting song name
  songName <- df[i, "track_name"]$track_name
  
  ## Getting lyrics
  temp <- as.data.frame(taylor_all_songs[i,"lyrics"]$lyrics)
  lyrics <- tolower(gsub("[^A-Za-z0-9 ]", "", paste(temp$lyric, collapse = " ")))
  
  ## Update lyric_df
  lyric_matrix[i, 1] = songName
  lyric_matrix[i, 2] = lyrics
}

## converting back to dataframe 
lyric_df <- as.data.frame(lyric_matrix)
colnames(lyric_df) <- c("track_name", "lyrics")
lyric_df

```
```{r}
taylor_all_songs
```

## Initial EDA
```{r}
## Notes: should add streams vs release plot, and streams vs some of these characteristics

hist_1 <- taylor_all_songs %>%
  ggplot(aes(x = danceability)) + geom_histogram(binwidth = 0.01, fill = "black", color = "white") +
             labs(title = "Histogram of Danceability Values", x = "Danceability Values", y = "Frequency")

hist_2 <- taylor_all_songs %>%
  ggplot(aes(x = energy)) + geom_histogram(binwidth = 0.01, fill = "black", color = "white") +
             labs(title = "Histogram of Energy Values", x = "Energy Values", y = "Frequency")

hist_3 <- taylor_all_songs %>%
  ggplot(aes(x = speechiness)) + geom_histogram(binwidth = 0.01, fill = "black", color = "white") +
             labs(title = "Histogram of Speechiness Values", x = "Speechiness Values", y = "Frequency")

hist_4 <- taylor_all_songs %>%
  ggplot(aes(x = liveness)) + geom_histogram(binwidth = 0.01, fill = "black", color = "white") +
             labs(title = "Histogram of Liveness Values", x = "Liveness Values", y = "Frequency")


hist_5 <- taylor_all_songs %>%
  ggplot(aes(x = valence)) + geom_histogram(binwidth = 0.01, fill = "black", color = "white") +
             labs(title = "Histogram of Valence Values", x = "Valence Values", y = "Frequency")

#hist_6 <- taylor_all_songs %>%
 # ggplot(aes(x = as.integer(track_release))) + geom_histogram(binwidth = 0.01, fill = "black", color = "white") +
  #           labs(title = "Histogram of Release Dates", x = "Release Dates", y = "Frequency")

plot_grid(hist_1, hist_2, hist_3, hist_4, hist_5, nrow = 3)


```




```{r}
full_cluster <- read.csv("data/full.csv")

```







<<<<<<< HEAD
## Cluster EDA

```{r}
##Audio Cluster Read-in
audio_cluster <- read.csv("data/audio.csv")
audio_cluster <- audio_cluster %>%
  dplyr::mutate(audio_cluster_assignment = cluster_assignment) %>%
  dplyr::select(track_name, audio_cluster_assignment)

#Lyric Cluster Read-in
lyrics_cluster <- read.csv("data/lyrics.csv")
lyrics_cluster <- lyrics_cluster %>%
  dplyr::mutate(lyrics_cluster_assignment = cluster_assignment) %>%
  dplyr::select(track_name, lyrics_cluster_assignment)

##Join with taylor_all_songs
all_cluster_data_df <- full_cluster %>%
  inner_join(audio_cluster, by = "track_name") %>%
  inner_join(lyrics_cluster, by = "track_name")


all_cluster_data_df 
```

## EDA with all clusters Big Picture


```{r}
all_cluster_data_df %>%
  ggplot(aes(x = audio_cluster_assignment, y = lyrics_cluster_assignment)) + 
  geom_point() + 
  labs(x = "Audio Cluster Assignment", y = "Lyrics Cluster Assignment")
```

```{r}
all_cluster_data_df %>%
  ggplot(aes(x = audio_cluster_assignment, y = speechiness)) + 
  geom_bar(stat = "identity") + 
  labs(x = "Audio Cluster Assignment", y = "Speechiness")

all_cluster_data_df %>%
  ggplot(aes(x = lyrics_cluster_assignment, y = speechiness)) + 
  geom_bar(stat = "identity") + 
  labs(x = "Lyrics Cluster Assignment", y = "Speechiness")
```


```{r}
all_cluster_data_df %>%
  ggplot(aes(x = audio_cluster_assignment, y = acousticness)) + 
  geom_bar(stat = "identity") + 
  labs(x = "Audio Cluster Assignment", y = "Acousticness")

all_cluster_data_df %>%
  ggplot(aes(x = lyrics_cluster_assignment, y = acousticness)) + 
  geom_bar(stat = "identity") + 
  labs(x = "Lyrics Cluster Assignment", y = "Acousticness")
```

```{r}

all_cluster_data_df$track_release <- as.Date(all_cluster_data_df$track_release, origin = "1970-01-01")

all_cluster_data_df %>%
  ggplot(aes(x = audio_cluster_assignment, y = track_release)) + 
  geom_bar(stat = "identity") + 
  labs(x = "Audio Cluster Assignment", y = "track_release")


all_cluster_data_df %>%
  ggplot(aes(x = lyrics_cluster_assignment, y = acousticness)) + 
  geom_bar(stat = "identity") + 
  labs(x = "Lyrics Cluster Assignment", y = "Acousticness")
```

##EDA for specific audio clusters continuous variables

```{r}
audio_cluster = 0
all_cluster_data_df_audio_cluster_specific <- all_cluster_data_df %>%
  filter(audio_cluster_assignment == audio_cluster)

all_cluster_data_df_audio_cluster_specific_cut <- all_cluster_data_df_audio_cluster_specific %>%
  dplyr::select(-album_name, -ep, -album_release, -track_number, -track_name, -artist, -featuring, -bonus_track, -promotional_release, -single_release, -track_release, -mode, -time_signature, -explicit, -key_name, -mode_name, -key_mode, -lyrics, -lyrics_cluster_assignment, -audio_cluster_assignment, -streak)

df1 <- all_cluster_data_df_audio_cluster_specific_cut

for (col_name in colnames(df1)) { 
  
  col <- df1[col_name]
  
  plot <- ggplot(col, aes(x = col[[1]])) + 
    geom_histogram(fill = "black", color = "white") +
    labs(title = "Histogram", x = col_name, y = "Frequency")
  print(plot)
}

ggplot(all_cluster_data_df_audio_cluster_specific, aes(y = album_name)) + 
    geom_bar(fill = "black", color = "white") +
    labs(title = "Histogram", y = "Album Name", x = "Frequency")



print(nrow(df1))
```






##EDA for specific lyrics clusters continuous variables

```{r}
lyrics_cluster = 0
all_cluster_data_df_lyrcis_cluster_specific <- all_cluster_data_df %>%
  filter(lyrics_cluster_assignment == lyrics_cluster)

all_cluster_data_df_lyrics_cluster_specific_cut <- all_cluster_data_df_lyrcis_cluster_specific %>%
  dplyr::select(-album_name, -ep, -album_release, -track_number, -track_name, -artist, -featuring, -bonus_track, -promotional_release, -single_release, -track_release, -mode, -time_signature, -explicit, -key_name, -mode_name, -key_mode, -lyrics, -audio_cluster_assignment, -lyrics_cluster_assignment, -streak)

df2 <- all_cluster_data_df_lyrics_cluster_specific_cut

for (col_name in colnames(df2)) { 
  
  col <- df2[col_name]
  
  plot <- ggplot(col, aes(x = col[[1]])) + 
    geom_histogram(fill = "black", color = "white") +
    labs(title = "Histogram", x = col_name, y = "Frequency")
  print(plot)
}
print(ncol(df2))


```





##EDA for specific columns across all clusters

```{r}
##choose column
target_column = "speechiness"

##data cleaning
all_cluster_data_df_specific_cut <- all_cluster_data_df %>%
  dplyr::select(-ep, -album_release, -track_number, -track_name, -artist, -featuring, -bonus_track, -promotional_release, -single_release, -track_release, -mode, -time_signature, -explicit, -key_name, -mode_name, -key_mode, -lyrics, -streak)

```

```{r}
## for audio clusters
for (i in 0:14){
  temp_df <- all_cluster_data_df_specific_cut %>%
    filter(audio_cluster_assignment == i)
  
  t <- temp_df[target_column]
  
  plot2 <- ggplot(temp_df[target_column], aes(x = t[[1]])) + 
    geom_histogram(fill = "black", color = "white") +
    labs(title = "Histogram", x = paste("Cluster", i), y = "Frequency")

  print(plot2)
}


```





```{r}
## for audio clusters album_name
for (i in 0:14){
  temp_df <- all_cluster_data_df_specific_cut %>%
    filter(audio_cluster_assignment == i)
  
  t <- temp_df["album_name"]
  
  plot2 <- ggplot(temp_df["album_name"], aes(y = t[[1]])) + 
    geom_bar(fill = "black", color = "white") +
    labs(title = "Histogram", y = "Album Name", x = "Frequency")

  print(plot2)
}
```




```{r}
## for lyrics clusters
for (i in 0:14){
  temp_df <- all_cluster_data_df_specific_cut %>%
    filter(lyrics_cluster_assignment == i)
  
  t <- temp_df[target_column]
  
  plot2 <- ggplot(temp_df[target_column], aes(x = t[[1]])) + 
    geom_histogram(fill = "black", color = "white") +
    labs(title = "Histogram", x = paste("Cluster", i), y = "Frequency")

  print(plot2)
}

```

```{r}
## for lyrics clusters album_name
for (i in 0:14){
  temp_df <- all_cluster_data_df_specific_cut %>%
    filter(lyrics_cluster_assignment == i)
  
  t <- temp_df["album_name"]
  
  plot2 <- ggplot(temp_df["album_name"], aes(y = t[[1]])) + 
    geom_bar(fill = "black", color = "white") +
    labs(title = "Histogram", y = "Album Name", x = "Frequency")

  print(plot2)
}
```










